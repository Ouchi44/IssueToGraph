Containers shouldn't be relying on getting their environment variables from the NodeManager. For compatibility, the change in https://github.com/apache/hadoop/commit/9d4d30243b0fc9630da51a2c17b543ef671d035c was only done in trunk. The equivalent change in branch-2, https://github.com/apache/hadoop/commit/ac8fb579c6058fec60caf30682f902413d68edf3, does not remove all of the environment variables.